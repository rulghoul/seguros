<!DOCTYPE html>
{% extends 'base.html' %} 
{% load crispy_forms_tags %} 
{% block content %}

<div class="row" style="margin-bottom: 1em; margin-top: 1em;">
    <h3 class="col-5">{{ titulo }} {{ cliente }}</h3>
    {% if es_asesor %}
      <a class="btn btn-secondary col-2" href="{% url add cliente.pk %}">{{ add_label }}</a>
    {% endif %}
    <a class="btn btn-secondary col-2" href="{% url 'documentos:clientes' %}">Regresar</a>
    <input class="form-control col-4 ml-auto" id="myInput" type="text" placeholder="Buscar..">
</div>

<table class="table table-striped table-sm">
    <thead class="thead-dark">
        <tr>
            <th>Cliente</th>
            <th>Telefono</th>
            <th>Aseguradora</th>
            <th>Plan</th>
            <th>Numero de Poliza</th>
            <th>Forma de Pago</th>
            <th>Fecha de Pago</th>
            <th>Emision de Poliza</th>
            <th>Estatus</th>
            {% if user.is_staff %}
            <th>Asesor</th>
            {% endif %}
            <th></th>
        </tr>
    </thead>
    <tbody id="CuerpoCatalogo">
        {% for poliza in polizas %}
        <tr>
            <td>{{ poliza.persona_principal }}</td>
            <td>{{ poliza.persona_principal.telefono }}</td>
            <td>{{ poliza.empresa }}</td>
            <td>{{ poliza.plan }}</td>
            <td>{{ poliza.numero_poliza }}</td>
            <td>{{ poliza.forma_pago }}</td>
            <td>{{ poliza.fecha_pago }}</td>
            <td>{{ poliza.fecha_emision }}</td>
            <td>{{ poliza.estatus }}</td>
            {% if user.is_staff %}
            <td>{{ poliza.asesor_poliza.usuario.first_name }} {{ poliza.asesor_poliza.usuario.last_name }}</td>
            {% endif %}
            <td class="text-center">
              
              <a type="button" class="update-book btn btn-sm btn-secondary" data-bs-toggle="tooltip" title="Cargar Documentos" href="{% url documento_url poliza.pk %}?origin={{ request.path }}" >
                <span class="fa fa-upload"></span>
              </a>

              <a type="button" class="update-book btn btn-sm btn-warning" data-bs-toggle="tooltip" title="Mostrar siniestros" href="{% url siniestros_url poliza.pk %}?origin={{ request.path }}" >
                <span class="fa fa-person-falling-burst"></span>
              </a>

              <a type="button" class="update-book btn btn-sm btn-success" data-bs-toggle="tooltip" title="Enviar Recordatorio de pago" href="{% url recordatorio_url poliza.pk %}" >
                <span class="fa fa-envelope"></span>
              </a>
              <!-- Update book buttons -->
              <a type="button" class="update-book btn btn-sm btn-info"  data-bs-toggle="tooltip" title="Editar Poliza" href="{% url update poliza.pk cliente_pk %}" >
                <span class="fa fa-pencil"></span>
              </a>
              <!-- Delete book buttons -->
              <a type="button" class="delete-book btn btn-sm btn-danger" data-bs-toggle="tooltip" title="Borrar Poliza" href="{% url borra poliza.pk %}">
                <span class="fa fa-trash"></span>
              </a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script>
    $(document).ready(function(){
      $("#myInput").on("keyup", function() {
        var value = $(this).val().toLowerCase();
        $("#CuerpoCatalogo tr").filter(function() {
          $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        });
      });
    });
  </script>
{% endblock %}
