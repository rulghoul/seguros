{% extends 'base.html' %}
{% load getattributes %}
{% block title %}
  {{ titulo }}
{% endblock %}

{% load comprueba_tipo %}


{% block content %}
  <div class="row" style="margin-bottom: 1em; margin-top: 1em;">
    <h3 class="col-5">{{ titulo }}</h3>
    <input class="form-control col-4 ml-auto" id="myInput" type="text" placeholder="Buscar.." />
  </div>
  <form method="post" action="{% url redirige %}" enctype="multipart/form-data">
    <table class="table table-striped table-sm">
      <thead class="thead-dark">
        <tr>
          {% for encabezado in encabezados %}
            <th>{{ encabezado }}</th>
          {% endfor %}  
          <th></th>
        </tr>
      </thead>
      <tbody id="CuerpoCatalogo">
        {% if not form.instance.id %}
          <tr>
            {% include 'catalogos/save.html' %}
          </tr>
        {% endif %}
        {% for elemento in lista %}
          <tr>
            {% if form.instance.id == elemento.id %}
              {% include 'catalogos/save.html' %}
            {% else %}
              {% for campo in campos %}
              <td>
                {% if campo == 'activo' %}
                  {{ elemento.activo|yesno:'Activo,Inactivo,Indefinido' }}
                {% elif elemento|is_imagefield:campo %}
                  <a href="/media/{{ elemento|getattribute:campo }}" target="_blank">
                    <img src="/media/{{ elemento|getattribute:campo }}" alt="{{ elemento|getattribute:campo }}" style="height: 50px;">
                  </a>
                {% else %}
                  {{ elemento|getattribute:campo }}
                {% endif %}
                </td>
              {% endfor %}
              <td class="text-center">
                <!-- detalle -->
                <button formnovalidate class="btn btn-secondary p-1" 
                name="edit" value="{{ elemento.pk }}">
                <span class="fa fa-eye"></span>
                </button>
                <!-- Actualizar -->
                <button formnovalidate class="btn btn-success p-1" 
                name="edit" value="{{ elemento.pk }}">
                <span class="fa fa-pencil"></span>
                </button>
                <!-- Borrar -->
                <button formnovalidate class="btn btn-danger p-1" 
                name="delete" value="{{ elemento.pk }}">
                <span class="fa fa-trash"></span>
                </button>
              </td>
            {% endif %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </form>
  <script>
    $(document).ready(function () {
      $('#myInput').on('keyup', function () {
        var value = $(this).val().toLowerCase()
        $('#CuerpoCatalogo tr').filter(function () {
          $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        })
      })
    })
  </script>
{% endblock %}
